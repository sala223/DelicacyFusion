CREATE TABLE DELIVERY (DELIVERY_ID BIGINT AUTO_INCREMENT NOT NULL, TENANT_CODE VARCHAR(12), CLOSE_TIME DATETIME, CREATE_TIME DATETIME NOT NULL, ORDER_ID BIGINT NOT NULL, OWNER_ID BIGINT NOT NULL, STATUS VARCHAR(32), STORE_CODE VARCHAR(255) NOT NULL, PRIMARY KEY (DELIVERY_ID))
CREATE TABLE ORDERS (ORDER_ID BIGINT AUTO_INCREMENT NOT NULL, TENANT_CODE VARCHAR(12), CLOSE_TIME DATETIME, COMMENT VARCHAR(255), CREATE_TIME DATETIME NOT NULL, CURRENCY VARCHAR(255), DEPOSIT FLOAT, DINNER_TIME DATETIME NOT NULL, DISCOUNT DECIMAL(38), IS_TAKE_OUT TINYINT(1) default 0, OTHER_FEE FLOAT, OWNER_ID BIGINT NOT NULL, PROMOTION_NAME VARCHAR(128), SERVICE_CARD_ID BIGINT, SERVICE_FEE FLOAT, STATUS VARCHAR(32), STORE_CODE VARCHAR(255) NOT NULL, TOTAL_PAYMENT DECIMAL(38), TOTAL_PAYMENT_AFTER_DISCOUNT DECIMAL(38), PRIMARY KEY (ORDER_ID))
CREATE TABLE PAYMENT (PAYMENT_ID BIGINT AUTO_INCREMENT NOT NULL, TENANT_CODE VARCHAR(12), CLOSE_TIME DATETIME, CREATE_TIME DATETIME NOT NULL, CURRENCY VARCHAR(255), ORDER_ID BIGINT NOT NULL, OWNER_ID BIGINT NOT NULL, SPECIAL_DISCOUNT DECIMAL(38), STATUS VARCHAR(32), STORE_CODE VARCHAR(255) NOT NULL, TOTAL_AMOUNT DECIMAL(38), PRIMARY KEY (PAYMENT_ID))
CREATE TABLE SERVICE_CARD (ID BIGINT AUTO_INCREMENT NOT NULL, TENANT_CODE VARCHAR(12), CREATED_TIME DATETIME NOT NULL, ORDER_ID BIGINT, STORE_CODE VARCHAR(64) NOT NULL, PRIMARY KEY (ID))
CREATE TABLE TENANT (CODE VARCHAR(64) NOT NULL, ADDRESS VARCHAR(1024) NOT NULL, CHANGED_TIME DATETIME, CREATED_BY BIGINT, CREATED_TIME DATETIME NOT NULL, DESCRIPTION LONGTEXT, IS_ENABLED TINYINT(1) default 0, NAME VARCHAR(128) NOT NULL UNIQUE, OWNER BIGINT, PRIMARY KEY (CODE))
CREATE TABLE GLOBAL_CONFIGURATION (ID BIGINT AUTO_INCREMENT NOT NULL, TENANT_CODE VARCHAR(12), DOMAIN VARCHAR(64) NOT NULL, C_KEY VARCHAR(128) NOT NULL, C_VALUE LONGBLOB, PRIMARY KEY (ID))
CREATE UNIQUE INDEX IDX_GLOBAL_CONFIGURATION_T_DOMAIN_KEY ON GLOBAL_CONFIGURATION (DOMAIN, C_KEY, TENANT_CODE)
CREATE TABLE DINING_TABLE (TENANT_CODE VARCHAR(12) NOT NULL, CODE VARCHAR(255) NOT NULL, BAR_CODE VARCHAR(128), CAPACITY INTEGER, CHANGED_TIME DATETIME, CREATED_BY BIGINT, CREATED_TIME DATETIME NOT NULL, IS_ENABLED TINYINT(1) default 0, STORE_CODE VARCHAR(64) NOT NULL, PRIMARY KEY (TENANT_CODE, CODE))
CREATE UNIQUE INDEX IDX_DT_BAR_CODE ON DINING_TABLE (BAR_CODE)
CREATE INDEX IDX_DT_CODE ON DINING_TABLE (STORE_CODE, CODE)
CREATE INDEX INDEX_DINING_TABLE_CODE ON DINING_TABLE (CODE)
CREATE TABLE EMPLOYEE (TENANT_CODE VARCHAR(12) NOT NULL, CODE VARCHAR(255) NOT NULL, BIRTH DATE, CELL_PHONE VARCHAR(20), CHANGED_TIME DATETIME, CREATED_BY BIGINT, CREATED_TIME DATETIME NOT NULL, EMAIL VARCHAR(128) NOT NULL, FIRST_NAME VARCHAR(64), GENDER INTEGER, IS_ENABLED TINYINT(1) default 0, LAST_NAME VARCHAR(64), Login_USER_ID BIGINT, STORE_CODE VARCHAR(255), PRIMARY KEY (TENANT_CODE, CODE))
CREATE INDEX INDEX_EMPLOYEE_CODE ON EMPLOYEE (CODE)
CREATE TABLE ITEM (TENANT_CODE VARCHAR(12) NOT NULL, CODE VARCHAR(255) NOT NULL, CHANGED_TIME DATETIME, CREATED_BY BIGINT, CREATED_TIME DATETIME NOT NULL, IS_ENABLED TINYINT(1) default 0, PRICE FLOAT, STORE_CODE VARCHAR(64) NOT NULL, PRIMARY KEY (TENANT_CODE, CODE))
CREATE INDEX INDEX_ITEM_CODE ON ITEM (CODE)
CREATE TABLE ITEM_TEMPLATE (TENANT_CODE VARCHAR(12) NOT NULL, CODE VARCHAR(255) NOT NULL, CHANGED_TIME DATETIME, CREATED_BY BIGINT, CREATED_TIME DATETIME NOT NULL, PRICE_UNIT VARCHAR(255), DESCRIPTION LONGTEXT, IS_ENABLED TINYINT(1) default 0, ITEM_UNIT VARCHAR(255), NAME VARCHAR(128), PRICE FLOAT, TYPE VARCHAR(64), PRIMARY KEY (TENANT_CODE, CODE))
CREATE INDEX IDX_ITEM_TPL_T_NAME ON ITEM_TEMPLATE (NAME, TENANT_CODE)
CREATE INDEX INDEX_ITEM_TEMPLATE_CODE ON ITEM_TEMPLATE (CODE)
CREATE TABLE PROMOTION (TENANT_CODE VARCHAR(12) NOT NULL, CODE VARCHAR(255) NOT NULL, CHANGED_TIME DATETIME, CREATED_BY BIGINT, CREATED_TIME DATETIME NOT NULL, DETAILS VARCHAR(255) NOT NULL, IS_ENABLED TINYINT(1) default 0, NAME VARCHAR(128) NOT NULL, QUALIFIER VARCHAR(128) NOT NULL, STORE_CODE VARCHAR(64) NOT NULL, PROMOTION_TYPE VARCHAR(255) NOT NULL, VALID_FROM DATETIME NOT NULL, VALID_TO DATETIME NOT NULL, PRIMARY KEY (TENANT_CODE, CODE))
CREATE INDEX INDEX_PROMOTION_CODE ON PROMOTION (CODE)
CREATE TABLE ROOM (TENANT_CODE VARCHAR(12) NOT NULL, CODE VARCHAR(255) NOT NULL, CHANGED_TIME DATETIME, CREATED_BY BIGINT, CREATED_TIME DATETIME NOT NULL, CURRENCY VARCHAR(255), DESCRIPTION VARCHAR(1024), IS_ENABLED TINYINT(1) default 0, MINIMUM_COST DOUBLE, NAME VARCHAR(255) NOT NULL, STORE_CODE VARCHAR(64) NOT NULL, PRIMARY KEY (TENANT_CODE, CODE))
CREATE UNIQUE INDEX IDX_ROOM_STR_CODE ON ROOM (STORE_CODE, CODE, TENANT_CODE)
CREATE UNIQUE INDEX IDX_ROOM_STR_NAME ON ROOM (STORE_CODE, NAME, TENANT_CODE)
CREATE INDEX INDEX_ROOM_CODE ON ROOM (CODE)
CREATE TABLE STORE (TENANT_CODE VARCHAR(12) NOT NULL, CODE VARCHAR(255) NOT NULL, ADDRESS VARCHAR(1024) NOT NULL, BUSINESS_HOUR_FROM INTEGER NOT NULL, BUSINESS_HOUR_TO INTEGER NOT NULL, CHANGED_TIME DATETIME, CREATED_BY BIGINT, CREATED_TIME DATETIME NOT NULL, DESCRIPTION LONGTEXT, IMG_ID VARCHAR(512), IS_ENABLED TINYINT(1) default 0, NAME VARCHAR(255) NOT NULL, TELEPHONE1 VARCHAR(32) NOT NULL, TELEPHONE2 VARCHAR(32), TRAFFIC_INFO VARCHAR(1024), PRIMARY KEY (TENANT_CODE, CODE))
CREATE UNIQUE INDEX IDX_STORE_T_CODE ON STORE (CODE, TENANT_CODE)
CREATE UNIQUE INDEX IDX_STORE_T_NAME ON STORE (NAME, TENANT_CODE)
CREATE INDEX INDEX_STORE_CODE ON STORE (CODE)
CREATE TABLE PERMISSIONS (NAME VARCHAR(128) NOT NULL, DESCRIPTION VARCHAR(1025), PRIMARY KEY (NAME))
CREATE TABLE ROLES (DESCRIPTION VARCHAR(1025), NAME VARCHAR(128) NOT NULL, DOMAIN VARCHAR(64) NOT NULL, PRIMARY KEY (NAME, DOMAIN))
CREATE TABLE USERS (ID BIGINT AUTO_INCREMENT NOT NULL, AGE INTEGER, CELLPHONE VARCHAR(20), CHANGED_TIME DATETIME, CREATED_TIME DATETIME NOT NULL, EMAIL VARCHAR(128) NOT NULL, FIRSTNAME VARCHAR(128), GENDER INTEGER, IMAGEID VARCHAR(512), IS_CELL_PHONE_VERIFIED TINYINT(1) default 0, IS_EMAIL_VERIFIED TINYINT(1) default 0, LASTNAME VARCHAR(128), LOCKED TINYINT(1) default 0, NICKNAME VARCHAR(128), PASSWORD VARCHAR(256) NOT NULL, WEIBO_ACCOUNT VARCHAR(128) UNIQUE, PRIMARY KEY (ID))
CREATE UNIQUE INDEX INDEX_USERS_WEIBO_ACCOUNT ON USERS (WEIBO_ACCOUNT)
CREATE UNIQUE INDEX INDEX_USERS_CELLPHONE ON USERS (CELLPHONE)
CREATE UNIQUE INDEX INDEX_USERS_EMAIL ON USERS (EMAIL)
CREATE TABLE DELIVERY_LINE (ITEM_CODE VARCHAR(255) NOT NULL, LINE_NUMBER BIGINT NOT NULL, QUANTITY INTEGER, ROOM_CODE VARCHAR(255), DELIVERY_ID BIGINT)
CREATE TABLE ORDER_LINE (COMMENT VARCHAR(256), DISCOUNT DECIMAL(38), ITEM_CODE VARCHAR(255) NOT NULL, ITEM_NAME VARCHAR(128), ITEM_UNIT VARCHAR(32), LINE_NUMBER INTEGER NOT NULL, PRICE FLOAT, PROMOTION_NAME VARCHAR(255), PROMOTION_PRICE FLOAT, QUANTITY INTEGER, TABLE_CODE VARCHAR(255), TOTAL_PAYMENT DECIMAL(38), TOTAL_PAYMENT_AFTER_DISCOUNT DECIMAL(38), ORDER_ID BIGINT)
CREATE TABLE PAYMENT_LINE (AMOUNT DECIMAL(38), EXTERNAL_TRANSACTION_ID BIGINT, LINE_NUMBER BIGINT NOT NULL, METHOD VARCHAR(32), TIME_OF_PAYMENT VARCHAR(255), PAYMENT_ID BIGINT)
CREATE TABLE SERVICE_TABLE (SERVICE_ID BIGINT, TABLE_CODE VARCHAR(255))
CREATE TABLE ITEM_TEMPLATE_PICTURE (FORMAT VARCHAR(16) NOT NULL, HEIGTH INTEGER, IMG_ID VARCHAR(512) NOT NULL, WIDTH INTEGER, ITEM_CODE VARCHAR(255), TENANT_CODE VARCHAR(12))
CREATE TABLE ITEM_TEMPLATE_CATEGORY (ITEM_CODE VARCHAR(255), TENANT_CODE VARCHAR(12), CATEGORY_CODE VARCHAR(255))
CREATE TABLE RULE_PARAMETER (NAME VARCHAR(32) NOT NULL, VALUE VARCHAR(128) NOT NULL, PROMOTION_CODE VARCHAR(255), TENANT_CODE VARCHAR(12))
CREATE TABLE PROMOTION_CATEGORY (PROMOTION_CODE VARCHAR(255), TENANT_CODE VARCHAR(12), CATEGORY_CODE VARCHAR(255))
CREATE TABLE PROMOTION_ITEM (PROMOTION_CODE VARCHAR(255), TENANT_CODE VARCHAR(12), ITEM_CODE VARCHAR(255))
CREATE TABLE ROOM_TABLE (ROOM_CODE VARCHAR(255) NOT NULL, TENANT_CODE VARCHAR(12) NOT NULL, TABLE_CODE VARCHAR(255) NOT NULL UNIQUE, PRIMARY KEY (ROOM_CODE, TENANT_CODE, TABLE_CODE))
CREATE TABLE ROLE_PERMISSION (NAME VARCHAR(128) NOT NULL, DOMAIN VARCHAR(64) NOT NULL, permissions_NAME VARCHAR(128) NOT NULL, PRIMARY KEY (NAME, DOMAIN, permissions_NAME))
CREATE TABLE USER_ROLE (DOMAIN VARCHAR(64) NOT NULL, NAME VARCHAR(128) NOT NULL, USER_ID BIGINT)
CREATE TABLE USER_TENANT (USER_ID BIGINT, TENANT_CODE VARCHAR(255))
ALTER TABLE DELIVERY_LINE ADD CONSTRAINT FK_DELIVERY_LINE_DELIVERY_ID FOREIGN KEY (DELIVERY_ID) REFERENCES DELIVERY (DELIVERY_ID)
ALTER TABLE ORDER_LINE ADD CONSTRAINT FK_ORDER_LINE_ORDER_ID FOREIGN KEY (ORDER_ID) REFERENCES ORDERS (ORDER_ID)
ALTER TABLE PAYMENT_LINE ADD CONSTRAINT FK_PAYMENT_LINE_PAYMENT_ID FOREIGN KEY (PAYMENT_ID) REFERENCES PAYMENT (PAYMENT_ID)
ALTER TABLE SERVICE_TABLE ADD CONSTRAINT FK_SERVICE_TABLE_SERVICE_ID FOREIGN KEY (SERVICE_ID) REFERENCES SERVICE_CARD (ID)
ALTER TABLE ITEM_TEMPLATE_PICTURE ADD CONSTRAINT FK_ITEM_TEMPLATE_PICTURE_TENANT_CODE FOREIGN KEY (TENANT_CODE, ITEM_CODE) REFERENCES ITEM_TEMPLATE (TENANT_CODE, CODE)
ALTER TABLE ITEM_TEMPLATE_CATEGORY ADD CONSTRAINT FK_ITEM_TEMPLATE_CATEGORY_TENANT_CODE FOREIGN KEY (TENANT_CODE, ITEM_CODE) REFERENCES ITEM_TEMPLATE (TENANT_CODE, CODE)
ALTER TABLE RULE_PARAMETER ADD CONSTRAINT FK_RULE_PARAMETER_TENANT_CODE FOREIGN KEY (TENANT_CODE, PROMOTION_CODE) REFERENCES PROMOTION (TENANT_CODE, CODE)
ALTER TABLE PROMOTION_CATEGORY ADD CONSTRAINT FK_PROMOTION_CATEGORY_TENANT_CODE FOREIGN KEY (TENANT_CODE, PROMOTION_CODE) REFERENCES PROMOTION (TENANT_CODE, CODE)
ALTER TABLE PROMOTION_ITEM ADD CONSTRAINT FK_PROMOTION_ITEM_TENANT_CODE FOREIGN KEY (TENANT_CODE, PROMOTION_CODE) REFERENCES PROMOTION (TENANT_CODE, CODE)
ALTER TABLE ROOM_TABLE ADD CONSTRAINT FK_ROOM_TABLE_TENANT_CODE FOREIGN KEY (TENANT_CODE, ROOM_CODE) REFERENCES ROOM (TENANT_CODE, CODE)
ALTER TABLE ROLE_PERMISSION ADD CONSTRAINT FK_ROLE_PERMISSION_permissions_NAME FOREIGN KEY (permissions_NAME) REFERENCES PERMISSIONS (NAME)
ALTER TABLE ROLE_PERMISSION ADD CONSTRAINT FK_ROLE_PERMISSION_NAME FOREIGN KEY (NAME, DOMAIN) REFERENCES ROLES (NAME, DOMAIN)
ALTER TABLE USER_ROLE ADD CONSTRAINT FK_USER_ROLE_USER_ID FOREIGN KEY (USER_ID) REFERENCES USERS (ID)
ALTER TABLE USER_TENANT ADD CONSTRAINT FK_USER_TENANT_USER_ID FOREIGN KEY (USER_ID) REFERENCES USERS (ID)
